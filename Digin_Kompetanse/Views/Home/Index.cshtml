@model Digin_Kompetanse.Models.ViewModels.KompetanseRegistreringViewModel

@{
    ViewData["Title"] = "Kompetansekartlegging";
    var fagområder = ViewBag.Fagområder as List<Fagområde> ?? new List<Fagområde>();
}

<h2>Registrer kompetanse</h2>
<script src="js/site.js"></script>

<div class="form-container">
    <form method="post">
        <div class="form-group">
            <input asp-for="BedriftNavn" placeholder="Bedriftens navn" class="form-control" required />
        </div>

        <div class="form-group">
            <input asp-for="BedriftEpost" type="email" placeholder="E-postadresse" class="form-control" required />
        </div>

        <div class="form-group">
            <label for="fagområde">Fagområde</label>
            <select asp-for="FagområdeId" id="fagområde" class="form-control">
                <option value="">Velg fagområde</option>
                @foreach (var f in fagområder)
                {
                    <option value="@f.FagområdeId">@f.FagområdeNavn</option>
                }
            </select>
        </div>

        <div class="form-group">
            <label for="kompetanse">Kompetanse</label>
            <select asp-for="KompetanseId" id="kompetanse" class="form-control">
                <option value="">Velg kompetanse</option>
            </select>
        </div>

        <div class="form-group">
            <label for="underkompetanse">Underkompetanse</label>
            <select asp-for="UnderkompetanseId" id="underkompetanse" class="form-control">
                <option value="">Velg underkompetanse</option>
            </select>
        </div>

        <div class="form-group">
            <textarea asp-for="Beskrivelse" rows="4" placeholder="Beskrivelse" class="form-control"></textarea>
        </div>

        <div class="form-group button-wrapper mt-3">
            <button type="submit" class="btn btn-primary btn-submit">Send inn</button>
        </div>
    </form>
</div>

@section Scripts {
<script>
    const fagSelect = document.getElementById("fagområde");
    const kompetanseSelect = document.getElementById("kompetanse");
    const underkompetanseSelect = document.getElementById("underkompetanse");

    fagSelect.addEventListener("change", function () {
        const fagId = this.value;
        kompetanseSelect.innerHTML = '<option value="">Velg kompetanse</option>';
        underkompetanseSelect.innerHTML = '<option value="">Velg underkompetanse</option>';

        if (!fagId) return;

        fetch(`/Home/GetKompetanser?fagområdeId=${fagId}`)
            .then(res => res.json())
            .then(data => {
                data.forEach(k => {
                    const opt = document.createElement("option");
                    opt.value = k.kompetanseId;       // camelCase
                    opt.text = k.kompetanseKategori;  // camelCase
                    kompetanseSelect.appendChild(opt);
                });
            });
    });

    kompetanseSelect.addEventListener("change", function () {
        const kompetanseId = this.value;
        underkompetanseSelect.innerHTML = '<option value="">Velg underkompetanse</option>';

        if (!kompetanseId) return;

        fetch(`/Home/GetUnderkompetanser?kompetanseId=${kompetanseId}`)
            .then(res => res.json())
            .then(data => {
                data.forEach(uk => {
                    const opt = document.createElement("option");
                    opt.value = uk.underkompetanseId;       // camelCase
                    opt.text = uk.underkompetanseNavn;      // camelCase
                    underkompetanseSelect.appendChild(opt);
                });
            });
    });
</script>
}
